---
import CompareDemo from "@/widgets/comparison/widget.astro";
import "@/styles/global.css";
import { NODE_ENV } from "astro:env/client";
import SpeedInsights from "@vercel/speed-insights/astro";
import Posthog from "@/components/posthog.astro";
import AuroraBackground from "@/components/ui/aurora-background.astro";
import { defaultLang, getTranslations } from "@/i18n/utils";
import AboutUs from "@/widgets/about-us/widget.astro";
import { ContactUs } from "@/widgets/contact-us";
import Features from "@/widgets/features/widget.astro";
import Footer from "@/widgets/footer/widget.astro";
import HeroSection from "@/widgets/hero/widget.astro";
import AppNav from "@/widgets/navbar/widget.astro";
import { ScrollToTop } from "@/widgets/scroll-to-top/widget";

const lang = defaultLang;
const t = await getTranslations(lang);
---

<script is:inline>
	const getThemePreference = () => {
		if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
			return localStorage.getItem('theme');
		}
		return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
	};
	const isDark = getThemePreference() === 'dark';
	document.documentElement.classList[isDark ? 'add' : 'remove']('dark');
 	
	if (typeof localStorage !== 'undefined') {
		const observer = new MutationObserver(() => {
			const isDark = document.documentElement.classList.contains('dark');
			localStorage.setItem('theme', isDark ? 'dark' : 'light');
		});
		observer.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });
	}
</script>

<html lang={lang}>
    <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width" />
      <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
      <meta name="generator" content={Astro.generator} />
      <title>SkySearch</title>

      {NODE_ENV === "production" && <Posthog />}
      {NODE_ENV === "production" && <SpeedInsights />}
    </head>

    <body>
      <AuroraBackground>
        <AppNav lang={lang} t={t} />
        <HeroSection lang={lang} t={t} />
        <Features lang={lang} t={t} />
        <CompareDemo lang={lang} t={t} />
        <AboutUs lang={lang} t={t} />
        <ContactUs lang={lang} t={t} />
        <Footer lang={lang} t={t} />
        <ScrollToTop client:load />
      </AuroraBackground>
    </body>
</html>
